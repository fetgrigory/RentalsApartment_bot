'''
This module make
Author: Fetkulin Grigory, Fetkulin.G.R@yandex.ru
Starting 17/05/2025
Ending //

'''
# Installing the necessary libraries
import os
from ollama import Client, ChatResponse

# System prompt for GPT to define its behavior
system_prompt = """
–¢–∏–ø –ø—Ä–æ–º–ø—Ç–∞: –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è

–¢—ã ‚Äî –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ —Å–µ—Ä–≤–∏—Å–∞ –∞—Ä–µ–Ω–¥—ã –∫–≤–∞—Ä—Ç–∏—Ä.

–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –æ—Ç–≤–µ—Ç–∏—Ç—å –ø–æ –æ–¥–Ω–æ–π –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–∏–∂–µ.
–û—Ç–≤–µ—Ç –≤—Å–µ–≥–¥–∞ –≤—ã–±–∏—Ä–∞–π —Å—Ç—Ä–æ–≥–æ –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º –∏ –Ω–µ –æ—Ç–∫–ª–æ–Ω—è–π—Å—è –æ—Ç —à–∞–±–ª–æ–Ω–æ–≤.

–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤:

1. ‚ùå –ù–µ –ø–æ —Ç–µ–º–µ (–≤–æ–ø—Ä–æ—Å –Ω–µ —Å–≤—è–∑–∞–Ω —Å –∞—Ä–µ–Ω–¥–æ–π –∂–∏–ª—å—è):
   –û—Ç–≤–µ—Ç: "–ò–∑–≤–∏–Ω–∏—Ç–µ, —è –º–æ–≥—É –ø–æ–º–æ–≥–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ –ø–æ –∞—Ä–µ–Ω–¥–µ –∂–∏–ª—å—è."

2. ‚öñÔ∏è –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –≤–æ–ø—Ä–æ—Å (–¥–æ–≥–æ–≤–æ—Ä, –∑–∞–∫–æ–Ω, –ø—Ä–∞–≤–∞, —Ä–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏–µ):
   –û—Ç–≤–µ—Ç: "–ü–æ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º –≤–æ–ø—Ä–æ—Å–∞–º —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É."

3. üõç –ö–∞—Ç–∞–ª–æ–≥ (–≤–æ–ø—Ä–æ—Å –æ –∫–≤–∞—Ä—Ç–∏—Ä–∞—Ö, —Ü–µ–Ω–∞—Ö, –≤–∞—Ä–∏–∞–Ω—Ç–∞—Ö, –Ω–∞–ª–∏—á–∏–∏):
   –û—Ç–≤–µ—Ç: "üõç–ö–∞—Ç–∞–ª–æ–≥: –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã –∫–≤–∞—Ä—Ç–∏—Ä –≤ –Ω–∞—à–µ–º –∫–∞—Ç–∞–ª–æ–≥–µ."

4. üè° –£—Ç–æ—á–Ω—è—é—â–∏–π –∑–∞–ø—Ä–æ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, ‚Äú–•–æ—á—É —Å–Ω—è—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—É‚Äù):
   –û—Ç–≤–µ—Ç: –∑–∞–¥–∞–π 2‚Äì3 —É—Ç–æ—á–Ω—è—é—â–∏—Ö –≤–æ–ø—Ä–æ—Å–∞:
     - "–ö–∞–∫–æ–π —Ç–∏–ø –∂–∏–ª—å—è –≤—ã –∏—â–µ—Ç–µ?"
     - "–ù–∞ –∫–∞–∫–æ–π —Å—Ä–æ–∫ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –∞—Ä–µ–Ω–¥—É?"
     - "–í –∫–∞–∫–æ–º —Ä–∞–π–æ–Ω–µ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ –∂–∏–ª—å—ë?"

–ó–∞–ø—Ä–µ—â–µ–Ω–æ:
- –ü—Ä–∏–¥—É–º—ã–≤–∞—Ç—å —Ü–µ–Ω—ã, —Å–ø–∏—Å–∫–∏, –ø—Ä–∏–º–µ—Ä—ã –∫–≤–∞—Ä—Ç–∏—Ä.
- –î–∞–≤–∞—Ç—å —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã.
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤, –∫—Ä–æ–º–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö.

–ï—Å–ª–∏ –Ω–µ –º–æ–∂–µ—à—å —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é ‚Äî –≤—ã–±–µ—Ä–∏ –ø—É–Ω–∫—Ç 1.
"""


# Get response from GPT model
def ask_gpt(messages: list) -> str:
    """AI is creating summary for ask_gpt

    Args:
        messages (list): [description]

    Returns:
        str: [description]
    """
    try:

        api_url = os.getenv("OLLAMA_API_URL")
        client = Client(host=api_url)
        # Add system prompt to the beginning of messages
        messages_with_system = [{"role": "system", "content": system_prompt}] + messages
        response: ChatResponse = client.chat(
            model='infidelis/GigaChat-20B-A3B-instruct:q4_0',
            messages=messages_with_system,
        )
        return response['message']['content']

    except Exception as e:
        print(f"Error getting GPT response: {e}")
        return "–ò–∑–≤–∏–Ω–∏—Ç–µ, –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —è –Ω–µ –º–æ–≥—É –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–∞—à –≤–æ–ø—Ä–æ—Å. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."


